---
layout: ../../layouts/blog-post.astro
title: "Declarative Shadow DOM"
emoji: ğŸ–Š
date: 2024-11-03T18:41:35Z
tags:
    - note
---

Baseline 2024 ã§è¿½åŠ ã•ã‚ŒãŸã€ã“ã‚Œã¾ã§ JavaScript ã‹ã‚‰ã—ã‹ç”Ÿæˆã§ããªã‹ã£ãŸ Shadow DOM ã‚’ HTML ã§å®šç¾©ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹æ©Ÿèƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€Web Components ã‚’ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«å¯¾å¿œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã®ã‚ˆã†ãª HTML ã¨ã—ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ã§ Shadow DOM ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚([å‹•ä½œã‚µãƒ³ãƒ—ãƒ«](https://yaakaito.github.io/code-sandbox/declarative-shadow-dom/))

```html
<my-custom-element data-count="12345">
    <template shadowrootmode="open">
        <style>
            * {
                margin: 0;
                padding: 0;
            }
            .container {
                display: flex;
                gap: 8px;
            }
            .counter {
                font-weight: bold;
            }
            .increment, .decrement {
                width: 20px;
                cursor: pointer;
            }
        </style>
        <div class="container">
        <p class="counter">12345</p>
        <button class="increment">+</button>
        <button class="decrement">-</button>
        </div>
    </template>
</my-custom-element>
```

åŒåã§ `customElements.define` ã•ã‚ŒãŸ `HTMLElement` ãŒã‚ã‚Œã°ã€è‡ªå‹•çš„ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã€ `constructor` ã‚„ `connectedCallback` ã§ Hydration ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```js
class MyCustomElement extends HTMLElement {
    connectedCallback() {
        let count = parseInt(this.getAttribute('data-count'))
        this.shadowRoot.querySelector('.increment').addEventListener('click', () => {
            this.shadowRoot.querySelector('.counter').textContent = String(++count)
        })
        this.shadowRoot.querySelector('.decrement').addEventListener('click', () => {
            this.shadowRoot.querySelector('.counter').textContent = String(--count)
        })
    }
}
customElements.define("my-custom-element", MyCustomElement);
```

Declarative Shadow DOM ã®å½¢ã§ JavaScript ã‹ã‚‰è¦ç´ ã‚’è¿½åŠ ã™ã‚‹å ´åˆã€ `$el.innerHTML = htmlString` ã§ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã‹ã‚‰å®Ÿè¡ŒãŒè¡Œã‚ã‚Œãšã€ä»£ã‚ã‚Šã« `setHTMLUnsafe` ã‚„ `parseHTMLUnsafe` ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


# Refs

- [å®£è¨€å‹ã® Shadow DOM Â |Â  web.dev](https://web.dev/articles/declarative-shadow-dom?hl=ja)
- [HTML ã ã‘ã§ Shadow DOM ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®å®£è¨€å‹ Shadow DOM](https://azukiazusa.dev/blog/declarative-shadow-dom/)
- [Declarative Shadow DOMã‚’åˆ©ç”¨ã—ãŸWeb Componentsã‚’SSRãƒ»CSRã§å®Ÿç¾ã™ã‚‹](https://zenn.dev/cybozu_frontend/articles/web-standardized-component-in-server-and-client#declarative-shadow-dom-(dsd)-%E3%81%A8%E3%81%AF%EF%BC%9F)