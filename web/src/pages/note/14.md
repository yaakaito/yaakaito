---
layout: ../../layouts/blog-post.astro
title: "--experimental-strip-types と Node 組み込みランナーで TypeScript をテストをする"
emoji: 🖊
date: 2024-12-16T19:08:14Z
tags:
    - note
---

[前回](https://yaakai.to/note/4/) の続きのようなもので、Node 22.6 で `--experimental-strip-types` が入ったので swc-node を使う必要がなくなりました。次のようなコマンドで、 Node の組み込みテストランナーを使って TypeScript のテストが実行できます。

```sh
$ node --experimental-strip-types --watch --test 'src/**/*.test.ts'
```

ただしすんなり動くわけではなく、やはりモジュールの解決周りで調整が必要になります。ここに詳しく解説するスペースはないので、詳しく知りたい方はリンクを参照してください。

前回はコード上では `.js` を省略しない import とし、bundler 側で辻褄を合わせていました。`--experimental-strip-types` の場合は現状では `.(m)ts` が省略できなくなるので、コード上の import を `.ts` に書き直しました。このままだとエディタ上でエラーとなってしまうため、 `tsconfig.json` で `allowImportingTsExtensions ` と `noEmit` を立てます。

```json
{
    "compilerOptions": {
        "allowImportingTsExtensions": true,
        "noEmit": true
    }
}
```


また、`namespace` や `enum` のような、型の表現以外の TypeScript のコードを実行するには別途 `--experimental-transform-types` が必要です。今回は必要ないコードしかなかったので指定しませんでした。

## Refs

- [Node.jsでTypeScriptのコードを実行できるようになるかも - hiroppy's site](https://hiroppy.me/blog/nodejs-strip-type/)
- [TS 5.7の --rewriteRelativeImportExtensions オプションを使う前に読む記事](https://zenn.dev/uhyo/articles/rewrite-relative-import-extensions-read-before-use)
- https://nodejs.org/en/blog/release/v22.6.0