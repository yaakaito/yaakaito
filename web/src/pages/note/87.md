---
layout: ../../layouts/blog-post.astro
title: "Claude Code ã® PreToolUse Hook ã§èª¤ã£ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆ©ç”¨ã‚’æ­¢ã‚ã‚‹"
emoji: ğŸš¨
date: 2025-07-10T11:09:07Z
tags:
    - note
---

Claude Code ã«è¿½åŠ ã•ã‚ŒãŸ Hook æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€Œbun ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã« npm ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã€ã¨ã„ã†ã‚ˆã†ãªå‹•ä½œã‚’é˜²æ­¢ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ãã†ã ã£ãŸã®ã§è©¦ã—ãŸã€‚

- https://docs.anthropic.com/en/docs/claude-code/hooks

PreToolUse ã§ã¯è¨­å®šã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãŒ exit code 2 ã‚’è¿”ã™ã¨ã€å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã¦ã„ãŸãƒ„ãƒ¼ãƒ«åˆ©ç”¨ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ã•ã‚‰ã« JSON ã§è©³ã—ã„æƒ…å ±ã‚’ä¼ãˆã‚‹ã“ã¨ã§ Claude Code ãŒå¿…è¦ãªãƒªã‚«ãƒãƒªã‚’è¡Œã†ãŸã‚ã€ã“ã‚Œã«åˆã‚ã›ã¦æ¬¡ã®è¨­å®šã‚’è©¦ã—ãŸ:

```json
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "Bash",
      "hooks": [{
        "type": "command",
        "command": "jq -r '.tool_input.command // \"\"' | grep -qE \"^(npm|npx)\\s\" && echo '{\"decision\":\"block\",\"reason\":\"Consider using bun instead of npm/npx for better performance. Examples: npm install â†’ bun install, npm run â†’ bun run, npx â†’ bun x\"}' && exit 2 || true"
      }]
    }]
  }
}
```

å°‘ã—èª­ã¿ã‚„ã™ãã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜:

```
jq -r '.tool_input.command // \"\"' | grep -qE \"^(npm|npx)\\s\" &&
    echo '{
         \"decision\":\"block\",
         \"reason\":\"Consider using bun instead of npm/npx for better performance. Examples: npm install â†’ bun install, npm run â†’ bun run, npx â†’ bun x\"
    }' && exit 2
|| true
```

é›‘ã§ã¯ã‚ã‚‹ãŒã€ã“ã‚Œã§èª¤ã£ãŸ npm ã®å®Ÿè¡Œã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ããŸã€‚

<img width="1190" height="471" alt="Image" src="https://github.com/user-attachments/assets/f0bc5768-9a01-4468-bf9d-e1bb55ae34f9" />