---
layout: ../../layouts/blog-post.astro
title: "Static Assets ã® run_worker_first ã‚ªãƒ—ã‚·ãƒ§ãƒ³"
emoji: ğŸ–Š
date: 2025-03-07T23:05:35Z
tags:
    - note
---

Cloudflare Workers ã® Static Assets ã¯ã€é€šå¸¸ã§ã¯ã‚ã‚‹ URL ã«å¯¾ã—ã¦ `directory` ã«æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«ã‚ã‚‹é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒãƒãƒ³ã‚°ãŒå„ªå…ˆã•ã‚Œã€ `main` ã® Worker ã«ã¯åˆ°é”ã—ãªã„ãŒã€ã“ã‚Œã‚’é€†ã«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã€‚

- https://developers.cloudflare.com/workers/static-assets/routing/

wrangler.json ã®å ´åˆã¯æ¬¡ã®ã‚ˆã†ã«è¨­å®šã§ãã‚‹:

```jsonc
{
  "assets": {
    "binding": "ASSETS",
    "directory": "./public",
    "run_worker_first": true
  }
}
```

ã“ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã¨ã€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚ˆã‚Šå‰ã« `main` ã® Worker ã‚’å®Ÿè¡Œã§ãã‚‹ãŸã‚ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¦‹ã¦èªè¨¼ã™ã‚‹ã‚ˆã†ãªã“ã¨ãŒå¯èƒ½ã«ãªã‚‹ã€‚ãŸã ã—ã€å³å¯†ã«è¨€ãˆã°é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒãªããªã‚‹ãŸã‚ã€ fallback çš„ã« Static Assets ã¸ Worker ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```ts
export default {
  async fetch(request, env, ctx): Promise<Response> {
    // ....
    return env.ASSETS.fetch(request);
  },
} satisfies ExportedHandler<Env>;
```