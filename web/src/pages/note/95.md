---
layout: ../../layouts/blog-post.astro
title: "DevContainer ã§ Rebuild ã—ã¦ã‚‚ .zsh_history ãŒæ®‹ã‚‹ã‚ˆã†ã«ã™ã‚‹"
emoji: ğŸ“œ
date: 2025-10-20T20:33:26Z
tags:
    - note
---

ã‚³ãƒ³ãƒ†ãƒŠã‚’ Rebuild ã™ã‚‹æ©Ÿä¼šã¯ãã“ã¾ã§å¤šããªã„ã®ã§ã€ã“ã‚Œã¾ã§é©å½“ã«å†…å®¹ã‚’ã‚³ãƒ”ãƒšã—ãŸã‚Šãƒªãƒã‚¸ãƒˆãƒªé…ä¸‹ã«ç½®ã„ãŸã‚Šã—ã¦èª¤é­”åŒ–ã—ã¦ã„ãŸã®ã ãŒã€ã¤ã‚‰ããªã£ã¦ããŸã®ä»•çµ„ã¿åŒ–ã—ã‚ˆã†ã¨æ€ã£ãŸã€‚å±¥æ­´ã¯(ã‚³ãƒ³ãƒ†ãƒŠã®)å‘½ã‚ˆã‚Šé‡ã„ãƒ»ãƒ»ãƒ»ãƒ»ï¼
ã“ã‚Œã¾ã§ã‚„ã£ã¦ã“ãªã‹ã£ãŸç†ç”±ã®ä¸€ã¤ã«ã€Œãƒªãƒã‚¸ãƒˆãƒªã«å«ã¾ã‚Œã‚‹ DevContainer ã®è¨­å®šã«å€‹äººã®éƒ½åˆã‚’å«ã¿ãŸããªã„ã€ã¨ã„ã†ã®ãŒã‚ã‚Šã€ã„ã‚ã„ã‚æ–¹æ³•ã‚’è€ƒãˆã¦ã„ãŸã®ã ãŒçµæœã¨ã—ã¦ã¯å¦¥å”ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

æ–¹æ³•ã¯å…¬å¼ã«ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã« `.devcontainer.json` ã® `mounts` ã‚’ä½¿ã†ã€‚ã“ã‚Œã¯ Claude Code ã®å…¬å¼ DevContainer ã‚‚åŒã˜ã‚ˆã†ãªã“ã¨ã‚’ã—ã¦ã„ãŸã€‚

- https://code.visualstudio.com/remote/advancedcontainers/persist-bash-history
- https://github.com/anthropics/claude-code/blob/main/.devcontainer/devcontainer.json#L44-L47

ã¨ã¯ã„ãˆã“ã®ã¾ã¾ä½¿ã£ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªãã€ã‚‚ã‚ã‚‚ã‚ã®è¨­å®šã®ã ã‚‹ã•ã‚„ä¿å­˜å…ˆãŒæ°—ã«ãªã£ãŸã®ã§ã€ãƒ›ã‚¹ãƒˆå´ã« XDG Base Directory ã«æ²¿ã†ã‚ˆã†ãªå½¢ã§é…ç½®ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

```jsonc
// devcontainer.json
{
    "initializeCommand": "mkdir -p ${localEnv:HOME}/.local/share/devcontainer/${devcontainerId} && touch ${localEnv:HOME}/.local/share/devcontainer/${devcontainerId}/.zsh_history",
    "mounts": [
        "source=${localEnv:HOME}/.local/share/devcontainer/${devcontainerId}/.zsh_history,target=/home/vscode/.zsh_history,type=bind"
    ]
}
```

ã“ã‚Œã§ã ã„ãŸã„ãƒªãƒã‚¸ãƒˆãƒªæ¯ã«å±¥æ­´ãŒ  `~/.local/share/devcontainer/{devcontainerId}/.zsh_history` ã¸æºœã¾ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
`${containerEnv:HOME}` ãŒä½¿ãˆãã†ã ãŒ Build æ™‚ã«ã¯ä½¿ãˆãªã‹ã£ãŸã€‚

ã“ã‚Œã‚’å€‹äººçš„ãªè¨­å®šã¨ã—ã¦ `devcontainer.local.json` ã®ã‚ˆã†ãªå½¢ã§è¨­å®šã§ãã‚Œã°ç†æƒ³ã ã£ãŸã®ã ãŒãã†ã„ã£ãŸæ©Ÿèƒ½ã¯ç¾çŠ¶ã§ã¯ã§ããªã„ã‚ˆã†ã ã€‚

`.zsh_history` ä»¥å¤–ã«ã‚‚ Claude Code ãªã‚“ã‹ã®å±¥æ­´ã‚‚åŒã˜ã‚ˆã†ã«ã§ããã†ã ãŒã€ AI ã¨ã®ä¼šè©±ãƒ­ã‚°ã«ãã“ã¾ã§ä¾¡å€¤ã‚’æ„Ÿã˜ã¦ãªã„ã®ã¨å€‹äººçš„éãã‚‹ã®ã§ã‚„ã‚‹ã“ã¨ã¯ãªã„ã¨æ€ã†ã€‚

## Refs

- https://containers.dev/implementors/json_reference/
- https://docs.claude.com/ja/docs/claude-code/devcontainer

