---
layout: ../../layouts/blog-post.astro
title: "@mozilla/readability ã‚’ä½¿ã£ãŸ HTML ã‹ã‚‰ã®æœ¬æ–‡æŠ½å‡º"
emoji: ðŸ–Š
date: 2024-06-02T20:13:24Z
tags:
    - note
---

@mozilla/readability ã‚’ä½¿ã†ã¨ç°¡å˜ã«æœ¬æ–‡ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ Firefox ã®ãƒªãƒ¼ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã‚ˆã†ã§ã™ã€‚

- https://github.com/mozilla/readability
- https://support.mozilla.org/ja/kb/firefox-reader-view-clutter-free-web-pages

ä»Šå›žã¯ã“ã®çµæžœã‚’ Claude3 ã«æŠ•ã’ãŸã‹ã£ãŸã®ã§ã€DOMPurify ã‚’çµ„ã¿åˆã‚ã›ã¦æœ€å°é™æ–‡ç« ãŒã‚ã‹ã‚Šãã†ãª DOM ã¨ã—ã¦å–ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚

- https://github.com/cure53/DOMPurify

```ts
import { Readability } from '@mozilla/readability';
import { JSDOM } from 'jsdom';
import createDOMPurify from 'dompurify';

export const getReadability = async (url: string) => {
    const content = await fetch(url).then(res => res.text());
    const reader = new Readability(new JSDOM(content, {
        url
    }).window.document);
    const readability = (reader.parse() ?? { content: '' });
    return createDOMPurify(new JSDOM('').window).sanitize(readability.content, {
        ALLOWED_TAGS: [
            'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
            'blockquote', 'code', 'pre',
            'p', 'br', 'hr',
            'a', 'img', 'table', 'thead', 'tbody', 'tr', 'th', 'td',
            'ul', 'ol', 'li',
            'dl', 'dt', 'dd',
        ],
        ALLOWED_ATTR: ['href', 'src', 'title', 'alt'],
    });
}

```
