# システムパターン

## システムアーキテクチャ
このウェブサイトは以下の主要コンポーネントから構成されています：

1. **フロントエンド（Astroフレームワーク）**
   - 静的サイト生成による高速なページロード
   - マークダウンコンテンツの変換と表示
   - レスポンシブデザインの実装

2. **Cloudflare Workers**
   - 関連記事の提供サービス
   - ベクトルデータベースとの連携
   - サーバーレス関数としての実行

3. **外部API**
   - アイキャッチ画像の取得サービス（`https://articles.yaakai.to/eyecatch`）

## 主要な技術的決定

### コンテンツ管理
- マークダウンファイルによるコンテンツ管理（`.md`）
- フロントマターでのメタデータ管理（日付、絵文字、アイキャッチID等）
- ディレクトリ構造によるコンテンツの分類（blog/とnote/）

### データフロー
1. ビルド時：マークダウンファイルを静的HTMLに変換
2. 実行時：Astro.globによるファイル収集とソート
3. 表示時：条件付きレンダリング（サムネイル等）

### 表示パターン
- グリッドレイアウトによるコンテンツタイル表示
- フレックスボックスによる各タイル内の要素配置
- 条件付きレンダリングによるサムネイル画像の表示
- カードコンポーネント（BlogCard、NoteCard）によるコンテンツの統一表示

## デザインパターン

### ファイル構造パターン
```
web/src/
  ├── layouts/           # レイアウトコンポーネント
  │   ├── global-layout.astro
  │   └── blog-post.astro
  ├── components/        # 再利用可能なコンポーネント
  │   ├── BlogCard.astro # ブログ記事カード
  │   ├── NoteCard.astro # ノートカード
  │   └── ...
  └── pages/             # ページコンポーネント
      ├── index.astro    # ホームページ
      ├── blog/          # ブログ記事
      │   ├── index.astro
      │   └── *.md       # 各ブログ記事
      └── note/          # 短いノート
          ├── index.astro
          └── *.md       # 各ノート
```

### コンポーネント関係
- GlobalLayoutコンポーネント：共通レイアウトの提供
- BlogCardとNoteCardコンポーネント：記事とノートの表示パターンの抽象化
- ページコンポーネント：特定のページレイアウトと内容
- マークダウンコンテンツ：記事の実際の内容

### データ処理パターン
- `Astro.glob()`によるマークダウンファイルの収集
- `loadPosts()`関数での記事データの変換とソート
- 日付による記事の降順ソート
- `.slice(0, 3)`による最新記事の抽出
- 相対日付計算のための共通関数（BlogCardとNoteCardで共通化予定）

## 最近実装された機能と改善が必要な部分

### 絵文字とアイキャッチ画像の表示方法の最適化（BlogCard）
- **表示条件の分岐処理**：
  - アイキャッチ画像がある場合は、タイトルの先頭に絵文字を統合し表示
  - アイキャッチ画像がない場合は、独立した絵文字ブロックを表示
- **レイアウト順序の改善**：
  - ブログ記事ページで「日付→タイトル→アイキャッチ」の順に表示するよう変更
  - タイトルとアイキャッチの間に適切なマージン（1.2em）を追加

### NoteCardコンポーネントの改善（予定）
- **表示パターンの統一**：
  - BlogCardコンポーネントと同様の表示ロジックを適用
  - アイキャッチ画像がある場合はタイトルに絵文字を統合
  - レイアウト構造の一貫性の確保

### 重複コードの削減計画
- **相対日付関数の共通化**：
  - 現在BlogCardとNoteCardで重複している日付処理関数を共通ユーティリティに抽出
  - 再利用性の向上とコード保守性の改善

### サムネイル表示機能の実装
- **フロントマター連携**：
  - `eyecatch`プロパティに基づく条件付き表示
  - 型定義に`eyecatch?`オプショナルプロパティを追加
- **レイアウト最適化**：
  - タイルのスタイルをフレックスボックスに変更
  - サムネイル表示用のCSS追加
- **フォールバック表示**：
  - サムネイル画像のない場合は絵文字のみを表示する条件分岐
  - レイアウトの一貫性を保持

### Memory Bankによるドキュメンテーション
- プロジェクト全体の構造と目的を文書化
- 技術的な決定事項と実装パターンを記録
- 進捗状況と今後の計画を整理
- 定期的な更新による最新状態の維持
